---
title: Cambio de vigencia de contratos
description: Proceso para cambiar la vigencia de los contratos en el sistema INTEGRA
---

import { Steps } from '@astrojs/starlight/components';

El siguiente paso a paso describe el proceso que se ha realizado a las respuestas de soportes que solicitan correciones de errores en las fechas de las vigencias de contratos

## Paso a paso
<Steps>

1. Identificar el contrato con la vigencia a cambiar dentro de `CONTRATOS.INFORMACION_GENERAL` y dentro de la base de datos correspondiente.

    ```sql
    use NOMBRE_BASE_DE_DATOS;

    SELECT * FROM CONTRATOS.INFORMACION_GENERAL 
    WHERE Numero_Contrato='numero_contrato_a_buscar'
    ```

2. Mover el contrato a una tabla temporal para realizar el cambio de vigencia.

    ```sql
    SELECT * INTO #tempContrato FROM CONTRATOS.INFORMACION_GENERAL 
    WHERE Numero_Contrato='numero_contrato_a_buscar'
    ```
3. Actualizar la vigencia del contrato en la tabla temporal.

    ```sql
    UPDATE #tempContrato
    SET Vigencia_Contrato=nueva_vigencia
    ```
4. Registrar el cambio de la tabla temporal a la tabla `CONTRATOS.INFORMACION_GENERAL`

    ```sql
    INSERT INTO CONTRATOS.INFORMACION_GENERAL
    SELECT * FROM #tempContrato 
    ```
5. Verificar si el contrato tiene cesiones asociadas en la tabla `CONTRATOS.CESIONES`

    ```sql
    SELECT * FROM CONTRATOS.CESIONES 
    WHERE Numero_Contrato='numero_contrato_a_buscar'
    ```
6. Si el contrato tiene cesiones asociadas, proceder a actualizar la vigencia en la tabla `CONTRATOS.CESIONES`

    ```sql
    UPDATE CONTRATOS.CESIONES
    SET Vigencia_Contrato=nueva_vigencia
    WHERE Numero_Contrato='numero_contrato_a_buscar'
    AND Vigencia_Contrato=vigencia_anterior
    ```

7. Eliminar el contrato con la vigencia anterior.

    ```sql
    DELETE FROM CONTRATOS.INFORMACION_GENERAL 
    WHERE Numero_Contrato='numero_contrato_a_buscar' 
    AND Vigencia_Contrato=vigencia_anterior
    ```

8. Actualizar la `FechaContrato` en la tabla `CONTRATOS.INFORMACION_GENERAL` y la `Fecha_Cesion`
    en la tabla `CONTRATOS.CESIONES` si es necesario, para que coincidan con la nueva vigencia.

    :::note
    Recuerde que el campo `FechaContrato` es de tipo `SMALLDATETIME`y el campo `Fecha_Cesion` es de tipo `DATE`, por lo que la fecha debe ser ingresada en el formato adecuado.
    
    - `AAAA-MM-DD HH:MM:SS` → `SMALLDATETIME`.
    - `AAAA-MM-DD` → `DATE`.
    :::

    ```sql
    UPDATE CONTRATOS.INFORMACION_GENERAL
    SET FechaContrato=CAST('YYYY-MM-DDT00:00:00' AS smalldatetime); -- Fecha correspondiente a la nueva vigencia
    WHERE Numero_Contrato='numero_contrato_a_buscar'
    AND Vigencia_Contrato=nueva_vigencia

    UPDATE CONTRATOS.CESIONES
    SET Fecha_Cesion=CAST('YYYY-MM-DD' AS DATE) -- Fecha correspondiente a la nueva vigencia
    WHERE Numero_Contrato='numero_contrato_a_buscar'
    AND Vigencia_Contrato=nueva_vigencia
    ```

   

</Steps>
